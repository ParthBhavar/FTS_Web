@model FTS.Model.Entities.ConciliationApplicationModel
@{
    ViewBag.Title = "Conciliation Application";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken();
       <br />
    <section>
        <h3 style="font-weight:bold;">Conciliation Application</h3>
        <div class="col-lg-12 col-sm-12 col-md-12 col-xs-12 pull-right text-right text-danger"><span class="required">All <span class="text-danger">*</span> fields are compulsory</span></div>
    </section>   
       @Html.HiddenFor(e => e.ApplicationID , new { @ID="ApplicationID"})
       @Html.HiddenFor(e => e.CopyofCharteredDemandFile , new { @ID="DOC1"})
       @Html.HiddenFor(e => e.LetterOfIntervention , new { @ID="DOC2"})
       @Html.HiddenFor(e => e.OwnerCopyOfChartered , new { @ID="DOC3"})
        @Html.HiddenFor(e => e.MembershipVerificaionDetail , new { @ID="DOC4"})
       @Html.HiddenFor(e => e.AnnualReturnStatement , new { @ID="DOC5"})
 <div class="content-wrapper">

        <div class="row">
            <div class="col-12 grid-margin stretch-card">
                <div class="card">
                     <nav>
            <div class="nav nav-pills nav-fill" id="nav-tab" style="padding-bottom: 0rem;">
              <a class="nav-link" id="step1-tab" data-bs-toggle="tab">Step 1</a>
              <a class="nav-link" id="step2-tab" data-bs-toggle="tab">Step 2</a>
              <a class="nav-link" id="step3-tab" data-bs-toggle="tab">Step 3</a>
              <a class="nav-link active" id="step4-tab" data-bs-toggle="tab">Step 4</a>
            </div>
          </nav>
          <br>
                    <div class="card-body">
                           
                          <div class="form-group">
                              <div class="row">
                                  <div class="col-md-12" style="padding-left: 25%;">
                                      <p3><b>Upload Required Document(Only .PDF, .Doc, .Docx, .JPG, .JPEG, .xls, .xlsx files are allowed)</b></p3>
                                </div>
                                </div>
                         </div>  

                          <div class="form-group">
                            <div class="row" >
                                 <div class="col-12" style="padding-left: 27%;">
                                <div class="table-responsive">
                                    <table id="ReinstementList" class="display expandable-table" style="width:100%">
                                        <thead>
                                            <tr>
                                                  <th style="width:29%; text-align:center;" id="roleName">Name</th>
                                                  <th  style="width:5%; text-align:center;" id="Edit">Document</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                          <tr>
                                              <td>
                                                  @Html.Label("Authority Letter File: / ઓથોરિટી ફાઇલ:")<span class="text-danger">*</span>
                                              
                                              </td>
                                          <td>
                                          <input type="file" id="fileUpload" class="fileUpload"   onchange="return fileValidation(this.id)" >
                                       <span class="text-danger ValidationSpan" id="SpanfileUpload" style="display:none;">Please Insert File</span>   
                                      </td>
                                          <td>
                                              @if (@Model.CopyofCharteredDemandFile != "")
                                              {
                                                  <a  href="/ConciliationApplication/DownloadFile/?FileName=@Model.CopyofCharteredDemandFile" ><i class="fa fa-download"></i></a>
                                              }
                                         </td>
                                          </tr>
                                          <tr>
                                               <td>
                                                  @*@Html.Label("Letter Of Intervention")*@
                                                  @Html.Label("Intervention Letter: / હસ્તક્ષેપ પત્ર:")<span class="text-danger">*</span>
                                              </td>
                                              <td>
                                           <input type="file" id="fileUpload1" class="fileUpload1"   onchange="return fileValidation1(this.id)" >
                                           <span class="text-danger ValidationSpan" id="SpanfileUpload1" style="display:none;">Please select File</span>
                                         </td>
                                         <td>
                                            @if (@Model.LetterOfIntervention != "")
                                              {
                                            <a  href="/ConciliationApplication/DownloadFile/?FileName=@Model.LetterOfIntervention" ><i class="fa fa-download"></i></a>
                                                 }
                                        </td>
                                          </tr>
                                          <tr>
                                               <td>
                                                  @*@Html.Label("Owner Copy Of Chartered")*@
                                                  @Html.Label("Chartered Owner: / ચાર્ટર્ડ માલિક:")<span class="text-danger">*</span>
                                              </td>
                                              <td>
                                           <input type="file" id="fileUpload2" class="fileUpload2"   onchange="return fileValidation2(this.id)" >
                                           <span class="text-danger ValidationSpan" id="SpanfileUpload2" style="display:none;">Please select File</span>
                                         </td>
                                         <td>
                                              @if (@Model.OwnerCopyOfChartered != "")
                                              {
                                                 <a href="/ConciliationApplication/DownloadFile/?FileName=@Model.OwnerCopyOfChartered" ><i class="fa fa-download"></i></a>
                                              }
                                             </td>
                                          </tr>
                                           <tr>
                                               <td>
                                                  @*@Html.Label("Membership Verificaion Detail")*@
                                                    @Html.Label("Membership Verificaion: / સભ્યપદ ચકાસણી:")<span class="text-danger">*</span>
                                              </td>
                                              <td>
                                           <input type="file" id="fileUpload3" class="fileUpload2"   onchange="return fileValidation3(this.id)" >
                                           <span class="text-danger ValidationSpan" id="SpanfileUpload3" style="display:none;">Please select File</span>
                                         </td>
                                         <td>
                                              @if (@Model.MembershipVerificaionDetail != "")
                                              {
                                                 <a href="/ConciliationApplication/DownloadFile/?FileName=@Model.MembershipVerificaionDetail" ><i class="fa fa-download"></i></a>
                                              }
                                             </td>
                                          </tr>
                                           <tr>
                                               <td>
                                                  @*@Html.Label("Annual Return Statement")*@
                                                    @Html.Label("Annual Return: / વાર્ષિક વળતર:")<span class="text-danger">*</span>
                                              </td>
                                              <td>
                                           <input type="file" id="fileUpload4" class="fileUpload2"   onchange="return fileValidation4(this.id)" >
                                           <span class="text-danger ValidationSpan" id="SpanfileUpload4" style="display:none;">Please select File</span>
                                         </td>
                                         <td>
                                              @if (@Model.AnnualReturnStatement != "")
                                              {
                                                 <a href="/ConciliationApplication/DownloadFile/?FileName=@Model.AnnualReturnStatement" ><i class="fa fa-download"></i></a>
                                              }
                                             </td>
                                          </tr>
                                        </tbody>
                                    </table>
                                
                                </div>
                            </div>              
                        </div>
                         </div>  

                          <div class="form-group">
                            <div class="row">
                                 <div class="col-md-12" style="padding-left: 25%;">
                                    
                                        @Html.CheckBoxFor(e => e.IsSubmit, new { @ID="IsSubmit"} )

                                       <span class="text-danger ValidationSpan" id="SpanIsSubmit" style="display:none;">Please Insert File</span>
                                      @Html.Label("I Hereby Declare that the particulars given above are true to the best Of My knowledge And Beliefs")
                                <br> @Html.Label("હું આથી જાહેર કરું છું કે ઉપર આપેલ વિગતો મારી શ્રેષ્ઠ જાણકારી અને માન્યતાઓ માટે સાચી છે")
                                  </div>
                        </div>

                         </div> 
                           <div class="form-group">
                        <div class="row">
                                   <div class="col-md-12" style="padding-left: 31%;">
                               @*          @if(@Model.IsSubmit == true )
                                    {
                                        
                                        
                                    }*@
                                    <a id="Edit" class="btn btn-info"  href="/ConciliationApplication/AddConciliationTradunion?ApplicationID=@Model.ApplicationID&ISNew=1" > Previous</a>
                                    <input type="button" id="btnSave" class="btn btn-primary" value="Save" onclick="saveDocument(0)"/>

                                    @if (@Model.CopyofCharteredDemandFile == "" && @Model.LetterOfIntervention == "" && @Model.OwnerCopyOfChartered == "" && @Model.MembershipVerificaionDetail == "" && @Model.AnnualReturnStatement == "")
                                    {
                                        <input type="button" id="btnSubmit" disabled="disabled"  class="btn btn-primary" value="Submit" onclick="saveDocument(1)"/>
                                    }
                                    else
                                    {
                                          <input type="button" id="btnSubmit" disabled="disabled"  class="btn btn-primary" value="Submit" onclick="SubmitApplication()"/>
                                    }
                                    @Html.ActionLink("Cancel", "index", "ConciliationApplication", new { area = "" }, new { @class = "btn btn-primary" })


                                </div>
                                @if(@Model.IsSubmit ==true)
                                {
                                 <div class="col-md-12 mt-4" style="padding-left: 35%;">
                                 <span style="float:left"><a href="/ConciliationApplication/pdf/?ApplicationId=@Model.ApplicationID" class="btn btn-outline-danger" >
                                 <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-file-pdf" viewBox="0 0 16 16">
                                    <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z" />
                                     <path d="M4.603 12.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.701 19.701 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.187-.012.395-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.065.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.716 5.716 0 0 1-.911-.95 11.642 11.642 0 0 0-1.997.406 11.311 11.311 0 0 1-1.021 1.51c-.29.35-.608.655-.926.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.27.27 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.647 12.647 0 0 1 1.01-.193 11.666 11.666 0 0 1-.51-.858 20.741 20.741 0 0 1-.5 1.05zm2.446.45c.15.162.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.881 3.881 0 0 0-.612-.053zM8.078 5.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z" />
                                    </svg>
                                         Download Application <i class="fa fa-download ml-2"></i></a></span>
                                 </div>
                                }
                        </div>
                         </div> 
                         
                </div>
            </div>
        </div>
    </div>
     </div>

 <script>

     
           $(document).ready(function () {
            debugger;
                if ('@Model.IsSubmit' == "True") 
                {
                    $("#btnSave").attr('disabled', true); //disable input
                    $("#btnSubmit").attr('disabled', true); //disable input
                    @*$("#IsSubmit").attr('disabled', true); //disable input*@
                } 
                if ('@Model.ActionCode' == 11  || '@Model.ActionCode' == 13)
                {
                     $("#btnSave").attr('disabled', false); //disable input
                }

              @*  if ('@Model.CopyofCharteredDemandFile' == ""){
                    $("#IsSubmit").attr('disabled', true); //disable input
                }*@
               @* else
                {
                     $("#IsSubmit").attr('disabled', false); //disable input
                }*@
            
            });
          var ApplicationID = $('#ApplicationID').val();
          var AppIDl = ApplicationID.padStart(6, '0');
          var AppID = "CON" + AppIDl;

   function saveDocument(id) {
       debugger
        var ErrorCnt = 0;
            $('.ValidationSpan').hide();
           var files = $('#fileUpload').prop("files");
           var files1 = $('#fileUpload1').prop("files");
           var files2 = $('#fileUpload2').prop("files");
           var files3 = $('#fileUpload3').prop("files");
           var files4 = $('#fileUpload4').prop("files");

       if ($("#DOC1").val() == "") {
            if ($("#fileUpload").val() == "0" || $("#fileUpload").val() == "") {
                ErrorCnt++;
                $('#SpanfileUpload').show();
            }
             }

           if ($("#DOC2").val() == "") {
           if ($("#fileUpload1").val() == "0" || $("#fileUpload1").val() == "") {
               ErrorCnt++;
               $('#SpanfileUpload1').show();
           }
       }

       if ($("#DOC3").val() == "") {
           if ($("#fileUpload2").val() == "0" || $("#fileUpload2").val() == "") {
               ErrorCnt++;
               $('#SpanfileUpload2').show();
           }
       }
        if ($("#DOC4").val() == "") {
           if ($("#fileUpload3").val() == "0" || $("#fileUpload3").val() == "") {
               ErrorCnt++;
               $('#SpanfileUpload3').show();
           }
       }
        if ($("#DOC5").val() == "") {
           if ($("#fileUpload4").val() == "0" || $("#fileUpload4").val() == "") {
               ErrorCnt++;
               $('#SpanfileUpload4').show();
           }
       }

       
           if(files.length == 0 && files1.length  == 0 && files2.length  == 0 && files3.length  == 0 && files4.length  == 0  && $("#DOC1").val() != "")
           {
                swal("You are already upoaded Document if you need update So please select Document");
                 return false;
           }


           if (ErrorCnt > 0) {
                return false;
            }

       if (ErrorCnt == 0) {
           var IsSubmit = id;
         
           var ApplicationID = $('#ApplicationID').val();
           var Url = document.URL;
           var AppIDl = ApplicationID.padStart(6, '0');
           var AppID = "CON" + AppIDl;

           var url = "/ConciliationApplication/OnPostMyUploader?handler=MyUploader" + "&ApplicationID=" + ApplicationID + "&IsSubmit=" + IsSubmit + "&URL=" + Url + "&AppID=" + AppID;
           formData = new FormData();
           formData.append("MyUploader", files[0]);
           formData.append("MyUploader", files1[0]);
           formData.append("MyUploader", files2[0]);
            formData.append("MyUploader", files3[0]);
           formData.append("MyUploader", files4[0]);


           jQuery.ajax({
               type: 'POST',
               url: url,
               headers: {"XSRF-TOKEN": document.getElementsByName("__RequestVerificationToken")[0].value},
               data: formData,
               cache: false,
               contentType: false,
               processData: false,
               success: function(repo) {
                   debugger;
                   if (repo.status.ErrorCode == 0) {
                         swal(repo.status.ErrorMassage)
                        .then((value) => {
                            location.reload();
                         // window.location.href = "/ConciliationApplication/Index";
                    });
                   }
                   else {
                         swal(repo.status.ErrorMassage);
                        }
                   @*if (repo.status.ErrorCode == 0) {
                       alert(repo.status.ErrorMassage);
                       location.reload();
                   }
                   else{
                         alert(repo.status.ErrorMassage);
                   }*@
                  
               },
               error: function (request, message, error) 
                        {
                            debugger; 
                            swal(request.responseJSON);
                          }
           });
       }
}


   function fileValidation(id) {

    var fileInput = document.getElementById('fileUpload'); 
             
            var filePath = fileInput.value;
         
            // Allowing file type
            var allowedExtensions =
                    /(\.jpg|\.jpeg|\.png|\.pdf|\.doc|\.docx|\.xls|\.xlsx)$/i;
             
            if (!allowedExtensions.exec(filePath)) {
                alert('Invalid file type');
                fileInput.value = '';
                return false;
            }

             var size = $("#" + id)[0].files[0].size;

            if (size > 20000000) {
            //alert("Please upload file less than 20MB. Thanks!!");
            swal("Please upload file less than 20MB. Thanks!!");
            fileInput.value = '';
            return false;
            }
        }

  function fileValidation1(id) {

    var fileInput = document.getElementById('fileUpload1'); 
             
            var filePath = fileInput.value;
         
            // Allowing file type
            var allowedExtensions =
                    /(\.jpg|\.jpeg|\.png|\.pdf|\.doc|\.docx|\.xls|\.xlsx)$/i;
             
            if (!allowedExtensions.exec(filePath)) {
                alert('Invalid file type');
                fileInput.value = '';
                return false;
            }
             var size = $("#" + id)[0].files[0].size;

             if (size > 20000000) {
            //alert("Please upload file less than 20MB. Thanks!!");
            swal("Please upload file less than 20MB. Thanks!!");
            fileInput.value = '';
            return false;
        }
        }

  function fileValidation2(id) {

    var fileInput = document.getElementById('fileUpload2'); 
             
            var filePath = fileInput.value;
         
            // Allowing file type
            var allowedExtensions =
                    /(\.jpg|\.jpeg|\.png|\.pdf|\.doc|\.docx|\.xls|\.xlsx)$/i;
             
            if (!allowedExtensions.exec(filePath)) {
                alert('Invalid file type');
                fileInput.value = '';
                return false;
            }
             var size = $("#" + id)[0].files[0].size;

             if (size > 20000000) {
            //alert("Please upload file less than 20MB. Thanks!!");
            swal("Please upload file less than 20MB. Thanks!!");
            fileInput.value = '';
            return false;
        }
        }
   function fileValidation3(id) {

    var fileInput = document.getElementById('fileUpload3'); 
             
            var filePath = fileInput.value;
         
            // Allowing file type
            var allowedExtensions =
                    /(\.jpg|\.jpeg|\.png|\.pdf|\.doc|\.docx|\.xls|\.xlsx)$/i;
             
            if (!allowedExtensions.exec(filePath)) {
                alert('Invalid file type');
                fileInput.value = '';
                return false;
            }
            var size = $("#" + id)[0].files[0].size;

             if (size > 20000000) {
            //alert("Please upload file less than 20MB. Thanks!!");
            swal("Please upload file less than 20MB. Thanks!!");
            fileInput.value = '';
            return false;
        }
        }
    function fileValidation4(id) {
  
    var fileInput = document.getElementById('fileUpload4'); 
             
            var filePath = fileInput.value;
         
            // Allowing file type
            var allowedExtensions =
                    /(\.jpg|\.jpeg|\.png|\.pdf|\.doc|\.docx|\.xls|\.xlsx)$/i;
             
            if (!allowedExtensions.exec(filePath)) {
                alert('Invalid file type');
                fileInput.value = '';
                return false;
            }
            var size = $("#" + id)[0].files[0].size;

             if (size > 20000000) {
            //alert("Please upload file less than 20MB. Thanks!!");
            swal("Please upload file less than 20MB. Thanks!!");
            fileInput.value = '';
            return false;
        }
        }

    $('#IsSubmit').click(function () {
        //check if checkbox is checked
        if ($(this).is(':checked')) {

            $('#btnSubmit').removeAttr('disabled'); //enable input

        } else {
            $('#btnSubmit').attr('disabled', true); //disable input
        }
    });



    function SubmitApplication() {
            debugger;
             var ErrorCnt = 0;
            $('.ValidationSpan').hide();
            if ($("#IsSubmit").val() == "0" || $("#IsSubmit").val() == "") {
                ErrorCnt++;
                $('#SpanIsSubmit').show();
            }

            if (ErrorCnt > 0) {
                return false;
            }

            if (ErrorCnt == 0) {
                var myData = {
                    ApplicationID: $('#ApplicationID').val(),
                    IsSubmit: $('#IsSubmit').val(),
                    URL: document.URL,
                    AppID: AppID,
                };
                $.ajax
                    ({
                        type: "POST",
                        url: "/ConciliationApplication/ConciliationAppliactionUpdateSubmit",
                        headers: {"XSRF-TOKEN": document.getElementsByName("__RequestVerificationToken")[0].value},
                        dataType: "json",
                        data: myData,
                        success: function(data) {
                            debugger;
                            if (data.data.ErrorCode == 0) {
                                swal(data.data.ErrorMassage)
                                .then((value) => {
                                    window.location.href = "/ConciliationApplication/Index";
                                });
                            }
                            else {
                                swal(data.data.ErrorMassage);
                            }
                            @*if (data.data.ErrorCode == 0) {
                                window.location.href = "/ConciliationApplication/Index";
                                alert(data.data.ErrorMassage);
                            }
                            else {
                                 alert(data.data.ErrorMassage);
                            }*@

                        },

                        error: function (request, message, error) 
                        {
                            debugger; 
                            swal(request.responseJSON);
                        }
                    })
            }
    }
     </Script>
  
 }

 